<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CO Attainment Calculator - Direct & Indirect Assessment</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab:hover {
            color: #3498db;
        }
        
        .tab.active {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        
        .semester-selector, .course-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        select, button, input[type="number"] {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .calculate-btn {
            background-color: #2ecc71;
        }
        
        .calculate-btn:hover {
            background-color: #27ae60;
        }
        
        .reset-btn {
            background-color: #e74c3c;
        }
        
        .reset-btn:hover {
            background-color: #c0392b;
        }
        
        .export-btn {
            background-color: #9b59b6;
        }
        
        .export-btn:hover {
            background-color: #8e44ad;
        }
        
        .assessment-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        
        .assessment-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .assessment-section h3 i {
            color: #3498db;
        }
        
        .assessment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .method-card {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-top: 3px solid #3498db;
        }
        
        .method-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .method-card.direct {
            border-top-color: #2ecc71;
        }
        
        .method-card.indirect {
            border-top-color: #f39c12;
        }
        
        .method-parameters {
            margin-top: 15px;
        }
        
        .parameter {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .parameter label {
            font-weight: 500;
            color: #555;
        }
        
        .parameter input[type="number"] {
            width: 100px;
            text-align: center;
        }
        
        .parameter input[type="range"] {
            width: 150px;
        }
        
        .weight-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .weight-input input {
            width: 60px;
        }
        
        .weight-display {
            font-weight: bold;
            color: #3498db;
        }
        
        .co-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .co-table th, .co-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        
        .co-table th {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
        }
        
        .co-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .co-table td input[type="number"] {
            width: 80px;
        }
        
        .results-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 1100px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .results-card {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .results-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .co-results-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .co-results-table th, .co-results-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .co-results-table th {
            background-color: #3498db;
            color: white;
        }
        
        .co-results-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .attainment-level {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 3px;
        }
        
        .level-high {
            background-color: #d4edda;
            color: #155724;
        }
        
        .level-medium {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .level-low {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .chart-container {
            height: 350px;
            margin-top: 20px;
            position: relative;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .instructions {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
            border-left: 4px solid #ffc107;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #ff9800;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .note {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .weight-summary {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: center;
        }
        
        .weight-summary span {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .export-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .course-info {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .course-info h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .help-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            cursor: help;
            margin-left: 5px;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            display: block;
        }
        
        .matrix-table th, .matrix-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            min-width: 40px;
        }
        
        .matrix-table th {
            background-color: #3498db;
            color: white;
            position: sticky;
            top: 0;
        }
        
        .correlation-high {
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
        }
        
        .correlation-medium {
            background-color: #fff3cd;
            color: #856404;
            font-weight: bold;
        }
        
        .correlation-low {
            background-color: #f8d7da;
            color: #721c24;
            font-weight: bold;
        }
        
        .correlation-none {
            background-color: #f8f9fa;
            color: #6c757d;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>CO Attainment Calculator with Direct & Indirect Assessment</h1>
            <p class="subtitle">Calculate Course Outcome (CO) attainment using multiple assessment methods and weights</p>
        </header>
        
        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> How to Use This Calculator</h3>
            <ul>
                <li><strong>Step 1:</strong> Select a course and configure assessment methods</li>
                <li><strong>Step 2:</strong> Set weights for direct and indirect assessment methods (total must be 100%)</li>
                <li><strong>Step 3:</strong> Enter scores for each CO in each assessment method</li>
                <li><strong>Step 4:</strong> Click "Calculate CO Attainment" to see results</li>
                <li><strong>Step 5:</strong> Review attainment levels and generate reports</li>
            </ul>
            <p class="note">CO attainment is calculated as: (Direct Assessment × Direct Weight) + (Indirect Assessment × Indirect Weight)</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-tab="assessment">Assessment Setup</button>
            <button class="tab" data-tab="direct">Direct Assessment</button>
            <button class="tab" data-tab="indirect">Indirect Assessment</button>
            <button class="tab" data-tab="results">Results & Analysis</button>
            <button class="tab" data-tab="matrix">CO-PO Matrix</button>
        </div>
        
        <!-- Assessment Setup Tab -->
        <div id="assessment" class="tab-content active">
            <div class="controls">
                <div class="semester-selector">
                    <label for="semester"><strong>Semester:</strong></label>
                    <select id="semester">
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                        <option value="4">Semester 4</option>
                        <option value="5">Semester 5</option>
                        <option value="6">Semester 6</option>
                        <option value="7">Semester 7</option>
                        <option value="8">Semester 8</option>
                    </select>
                </div>
                
                <div class="course-selector">
                    <label for="course"><strong>Course:</strong></label>
                    <select id="course">
                        <option value="">Select a course</option>
                    </select>
                </div>
                
                <button id="configureBtn" class="calculate-btn">
                    <i class="fas fa-cog"></i> Configure Course
                </button>
            </div>
            
            <div id="courseInfo" class="course-info" style="display: none;">
                <!-- Course information will be displayed here -->
            </div>
            
            <div class="assessment-section">
                <h3><i class="fas fa-balance-scale"></i> Assessment Weight Configuration</h3>
                <p>Set the weights for direct and indirect assessment methods. Total must equal 100%.</p>
                
                <div class="assessment-methods">
                    <div class="method-card direct">
                        <h4><i class="fas fa-chart-line"></i> Direct Assessment</h4>
                        <p>Objective measurement of student performance against course outcomes</p>
                        
                        <div class="method-parameters">
                            <div class="parameter">
                                <label>Overall Weight:</label>
                                <div class="weight-input">
                                    <input type="number" id="directWeight" min="0" max="100" value="70" step="5">
                                    <span>%</span>
                                </div>
                            </div>
                            
                            <div class="parameter">
                                <label>Target Attainment:</label>
                                <div>
                                    <input type="range" id="directTarget" min="50" max="90" value="70" step="5">
                                    <span id="directTargetValue">70%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="direct-methods">
                            <h5>Direct Methods (Weight Distribution):</h5>
                            <div class="parameter">
                                <label>Internal Tests:</label>
                                <div class="weight-input">
                                    <input type="number" id="weightInternal" min="0" max="100" value="40" step="5">
                                    <span>% of Direct</span>
                                </div>
                            </div>
                            
                            <div class="parameter">
                                <label>End Semester Exam:</label>
                                <div class="weight-input">
                                    <input type="number" id="weightEndSem" min="0" max="100" value="40" step="5">
                                    <span>% of Direct</span>
                                </div>
                            </div>
                            
                            <div class="parameter">
                                <label>Assignments/Projects:</label>
                                <div class="weight-input">
                                    <input type="number" id="weightAssignments" min="0" max="100" value="20" step="5">
                                    <span>% of Direct</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="method-card indirect">
                        <h4><i class="fas fa-chart-bar"></i> Indirect Assessment</h4>
                        <p>Subjective measurement of perceptions and self-reported learning</p>
                        
                        <div class="method-parameters">
                            <div class="parameter">
                                <label>Overall Weight:</label>
                                <div class="weight-input">
                                    <input type="number" id="indirectWeight" min="0" max="100" value="30" step="5">
                                    <span>%</span>
                                </div>
                            </div>
                            
                            <div class="parameter">
                                <label>Target Attainment:</label>
                                <div>
                                    <input type="range" id="indirectTarget" min="50" max="90" value="75" step="5">
                                    <span id="indirectTargetValue">75%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="indirect-methods">
                            <h5>Indirect Methods (Weight Distribution):</h5>
                            <div class="parameter">
                                <label>Course Exit Survey:</label>
                                <div class="weight-input">
                                    <input type="number" id="weightExitSurvey" min="0" max="100" value="50" step="5">
                                    <span>% of Indirect</span>
                                </div>
                            </div>
                            
                            <div class="parameter">
                                <label>Alumni Feedback:</label>
                                <div class="weight-input">
                                    <input type="number" id="weightAlumni" min="0" max="100" value="30" step="5">
                                    <span>% of Indirect</span>
                                </div>
                            </div>
                            
                            <div class="parameter">
                                <label>Employer Feedback:</label>
                                <div class="weight-input">
                                    <input type="number" id="weightEmployer" min="0" max="100" value="20" step="5">
                                    <span>% of Indirect</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="weight-summary">
                    <p>Total Weight: <span id="totalWeight">100</span>% 
                    (Direct: <span id="directWeightDisplay">70</span>%, Indirect: <span id="indirectWeightDisplay">30</span>%)</p>
                    <p id="weightStatus" style="color: #2ecc71; font-weight: bold;">✓ Weights are properly balanced</p>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button id="saveWeightsBtn" class="calculate-btn">
                        <i class="fas fa-save"></i> Save Assessment Configuration
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Direct Assessment Tab -->
        <div id="direct" class="tab-content">
            <div class="assessment-section">
                <h3><i class="fas fa-chart-line"></i> Direct Assessment Input</h3>
                <p>Enter scores for each CO in direct assessment methods (scale: 0-100 or 0-3)</p>
                
                <div class="co-input-section">
                    <table id="directInputTable" class="co-table">
                        <!-- Direct assessment input table will be generated here -->
                    </table>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button id="calculateDirectBtn" class="calculate-btn">
                        <i class="fas fa-calculator"></i> Calculate Direct Attainment
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Indirect Assessment Tab -->
        <div id="indirect" class="tab-content">
            <div class="assessment-section">
                <h3><i class="fas fa-chart-bar"></i> Indirect Assessment Input</h3>
                <p>Enter scores for each CO in indirect assessment methods (scale: 1-5 Likert scale)</p>
                
                <div class="co-input-section">
                    <table id="indirectInputTable" class="co-table">
                        <!-- Indirect assessment input table will be generated here -->
                    </table>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button id="calculateIndirectBtn" class="calculate-btn">
                        <i class="fas fa-calculator"></i> Calculate Indirect Attainment
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Results & Analysis Tab -->
        <div id="results" class="tab-content">
            <div class="assessment-section">
                <h3><i class="fas fa-chart-pie"></i> CO Attainment Results</h3>
                
                <div class="results-grid">
                    <div class="results-card">
                        <h3><i class="fas fa-list-ol"></i> CO Attainment Summary</h3>
                        <table id="coResultsTable" class="co-results-table">
                            <!-- CO results table will be generated here -->
                        </table>
                        
                        <div class="summary-stats">
                            <div class="stat-card">
                                <div class="stat-label">Average CO Attainment</div>
                                <div class="stat-value" id="avgAttainment">0%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">COs Above Target</div>
                                <div class="stat-value" id="cosAboveTarget">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Overall Attainment</div>
                                <div class="stat-value" id="overallAttainment">0%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Attainment Level</div>
                                <div class="stat-value" id="attainmentLevel">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-card">
                        <h3><i class="fas fa-chart-bar"></i> CO Attainment Visualization</h3>
                        <div class="chart-container">
                            <canvas id="coChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3><i class="fas fa-file-alt"></i> Attainment Analysis</h3>
                    <div id="attainmentAnalysis" style="background-color: white; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        <p>Analysis will be displayed here after calculation...</p>
                    </div>
                </div>
                
                <div class="export-controls" style="margin-top: 30px;">
                    <button id="exportReportBtn" class="export-btn">
                        <i class="fas fa-file-export"></i> Export Attainment Report
                    </button>
                    <button id="printReportBtn" class="calculate-btn">
                        <i class="fas fa-print"></i> Print Report
                    </button>
                    <button id="resetAllBtn" class="reset-btn">
                        <i class="fas fa-redo"></i> Reset All Data
                    </button>
                </div>
            </div>
        </div>
        
        <!-- CO-PO Matrix Tab -->
        <div id="matrix" class="tab-content">
            <div class="assessment-section">
                <h3><i class="fas fa-project-diagram"></i> CO-PO/PSO Articulation Matrix</h3>
                <p>View and edit the correlation matrix between Course Outcomes and Program Outcomes</p>
                
                <div class="matrix-section">
                    <table id="matrixTable" class="matrix-table">
                        <!-- CO-PO matrix will be generated here -->
                    </table>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button id="saveMatrixBtn" class="calculate-btn">
                            <i class="fas fa-save"></i> Save Matrix
                        </button>
                        <button id="autoCalculateBtn" class="export-btn">
                            <i class="fas fa-robot"></i> Auto-Calculate PO Attainment
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>CO Attainment Calculator with Direct & Indirect Assessment | For Academic Quality Assurance</p>
            <p>Note: This tool helps calculate CO attainment using multiple assessment methods with configurable weights</p>
        </footer>
    </div>

    <!-- Include Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Sample course data with COs
        const courseDatabase = {
            "1": [
                {
                    code: "HS3152",
                    name: "Professional English - I",
                    cos: ["C101.1", "C101.2", "C101.3", "C101.4", "C101.5"],
                    coDescriptions: [
                        "Use appropriate words in professional context",
                        "Apply basic grammatical structures",
                        "Read and infer technical texts",
                        "Write definitions and descriptions",
                        "Express opinions effectively"
                    ]
                },
                {
                    code: "MA3151",
                    name: "Matrices and Calculus",
                    cos: ["C102.1", "C102.2", "C102.3", "C102.4", "C102.5"],
                    coDescriptions: [
                        "Apply matrix algebra methods",
                        "Use differential calculus tools",
                        "Apply calculus to multivariable functions",
                        "Solve integration problems",
                        "Apply multiple integral concepts"
                    ]
                }
            ],
            "2": [
                {
                    code: "HS3252",
                    name: "Professional English - II",
                    cos: ["C201.1", "C201.2", "C201.3", "C201.4", "C201.5"],
                    coDescriptions: [
                        "Manifest in professional forums",
                        "Interpret content proficiently",
                        "Use appropriate written tone",
                        "Read/write professionally",
                        "Apply formal communication etiquette"
                    ]
                },
                {
                    code: "CS3251",
                    name: "Programming in C",
                    cos: ["C206.1", "C206.2", "C206.3", "C206.4", "C206.5"],
                    coDescriptions: [
                        "Demonstrate C programming constructs",
                        "Develop simple C applications",
                        "Implement arrays and strings",
                        "Develop modular applications",
                        "Use structures and pointers"
                    ]
                }
            ]
        };

        // CO-PO Matrix sample data
        const sampleMatrix = {
            "HS3152": [
                [1, 1, 1, 1, 1, 3, 3, 1, 3, 0, 3, 0, 0, 0],
                [1, 1, 1, 1, 1, 3, 3, 1, 3, 0, 3, 0, 0, 0],
                [2, 3, 2, 3, 2, 3, 3, 2, 3, 3, 3, 0, 0, 0],
                [2, 3, 2, 3, 2, 3, 3, 2, 3, 3, 3, 0, 0, 0],
                [2, 3, 3, 3, 0, 3, 3, 2, 3, 0, 3, 0, 0, 0]
            ],
            "MA3151": [
                [3, 3, 1, 1, 0, 0, 0, 2, 0, 2, 3, 0, 0, 0],
                [3, 3, 1, 1, 0, 0, 0, 2, 0, 2, 3, 0, 0, 0],
                [3, 3, 1, 1, 0, 0, 0, 2, 0, 2, 3, 0, 0, 0],
                [3, 3, 1, 1, 0, 0, 0, 2, 0, 2, 3, 0, 0, 0],
                [3, 3, 1, 1, 0, 0, 0, 2, 0, 2, 3, 0, 0, 0]
            ]
        };

        // Global variables
        let currentCourse = null;
        let coChart = null;
        let assessmentData = {
            direct: {},
            indirect: {},
            weights: {
                direct: 70,
                indirect: 30,
                directMethods: {
                    internal: 40,
                    endSem: 40,
                    assignments: 20
                },
                indirectMethods: {
                    exitSurvey: 50,
                    alumni: 30,
                    employer: 20
                }
            },
            targets: {
                direct: 70,
                indirect: 75,
                overall: 70
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeCourseSelector();
            setupEventListeners();
            updateWeightDisplay();
            
            // Load saved data if available
            loadSavedData();
        });

        // Initialize course selector
        function initializeCourseSelector() {
            const semesterSelect = document.getElementById('semester');
            const courseSelect = document.getElementById('course');
            
            // Populate course selector based on selected semester
            semesterSelect.addEventListener('change', function() {
                const semester = this.value;
                courseSelect.innerHTML = '<option value="">Select a course</option>';
                
                if (courseDatabase[semester]) {
                    courseDatabase[semester].forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.code;
                        option.textContent = `${course.code} - ${course.name}`;
                        courseSelect.appendChild(option);
                    });
                }
            });
            
            // Trigger change to populate initially
            semesterSelect.dispatchEvent(new Event('change'));
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Configure course button
            document.getElementById('configureBtn').addEventListener('click', configureCourse);
            
            // Weight inputs
            document.getElementById('directWeight').addEventListener('input', updateWeights);
            document.getElementById('indirectWeight').addEventListener('input', updateWeights);
            
            // Direct method weights
            document.getElementById('weightInternal').addEventListener('input', updateDirectWeights);
            document.getElementById('weightEndSem').addEventListener('input', updateDirectWeights);
            document.getElementById('weightAssignments').addEventListener('input', updateDirectWeights);
            
            // Indirect method weights
            document.getElementById('weightExitSurvey').addEventListener('input', updateIndirectWeights);
            document.getElementById('weightAlumni').addEventListener('input', updateIndirectWeights);
            document.getElementById('weightEmployer').addEventListener('input', updateIndirectWeights);
            
            // Target sliders
            document.getElementById('directTarget').addEventListener('input', function() {
                document.getElementById('directTargetValue').textContent = this.value + '%';
                assessmentData.targets.direct = parseInt(this.value);
            });
            
            document.getElementById('indirectTarget').addEventListener('input', function() {
                document.getElementById('indirectTargetValue').textContent = this.value + '%';
                assessmentData.targets.indirect = parseInt(this.value);
            });
            
            // Save weights button
            document.getElementById('saveWeightsBtn').addEventListener('click', saveWeights);
            
            // Calculate buttons
            document.getElementById('calculateDirectBtn').addEventListener('click', calculateDirectAttainment);
            document.getElementById('calculateIndirectBtn').addEventListener('click', calculateIndirectAttainment);
            
            // Export and print buttons
            document.getElementById('exportReportBtn').addEventListener('click', exportReport);
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            document.getElementById('resetAllBtn').addEventListener('click', resetAllData);
            
            // Matrix buttons
            document.getElementById('saveMatrixBtn').addEventListener('click', saveMatrix);
            document.getElementById('autoCalculateBtn').addEventListener('click', autoCalculatePOAttainment);
        }

        // Configure selected course
        function configureCourse() {
            const semester = document.getElementById('semester').value;
            const courseCode = document.getElementById('course').value;
            
            if (!courseCode) {
                alert('Please select a course first.');
                return;
            }
            
            // Find the selected course
            currentCourse = null;
            if (courseDatabase[semester]) {
                currentCourse = courseDatabase[semester].find(course => course.code === courseCode);
            }
            
            if (!currentCourse) {
                alert('Course not found in database.');
                return;
            }
            
            // Display course info
            const courseInfoDiv = document.getElementById('courseInfo');
            courseInfoDiv.innerHTML = `
                <h3>${currentCourse.code} - ${currentCourse.name}</h3>
                <p><strong>Course Outcomes (COs):</strong> ${currentCourse.cos.length} outcomes defined</p>
                <p><strong>Assessment Methods:</strong> Direct (${assessmentData.weights.direct}%) + Indirect (${assessmentData.weights.indirect}%)</p>
            `;
            courseInfoDiv.style.display = 'block';
            
            // Initialize assessment data for this course
            initializeAssessmentData();
            
            // Create input tables
            createDirectInputTable();
            createIndirectInputTable();
            createResultsTable();
            createMatrixTable();
            
            // Switch to assessment setup tab
            document.querySelector('[data-tab="assessment"]').click();
            
            // Load saved data for this course if available
            loadCourseData();
        }

        // Initialize assessment data structure
        function initializeAssessmentData() {
            if (!currentCourse) return;
            
            // Initialize direct assessment data
            assessmentData.direct = {
                internal: {},
                endSem: {},
                assignments: {}
            };
            
            // Initialize indirect assessment data
            assessmentData.indirect = {
                exitSurvey: {},
                alumni: {},
                employer: {}
            };
            
            // Initialize with default values
            currentCourse.cos.forEach(co => {
                // Direct assessment (0-100 scale)
                assessmentData.direct.internal[co] = 0;
                assessmentData.direct.endSem[co] = 0;
                assessmentData.direct.assignments[co] = 0;
                
                // Indirect assessment (1-5 Likert scale)
                assessmentData.indirect.exitSurvey[co] = 3;
                assessmentData.indirect.alumni[co] = 3;
                assessmentData.indirect.employer[co] = 3;
            });
        }

        // Create direct assessment input table
        function createDirectInputTable() {
            if (!currentCourse) return;
            
            const table = document.getElementById('directInputTable');
            let html = `
                <thead>
                    <tr>
                        <th rowspan="2">CO Code</th>
                        <th rowspan="2">Description</th>
                        <th colspan="3">Direct Assessment Scores (0-100%)</th>
                        <th rowspan="2">Weighted Score</th>
                        <th rowspan="2">Direct Attainment</th>
                    </tr>
                    <tr>
                        <th>Internal Tests (${assessmentData.weights.directMethods.internal}%)</th>
                        <th>End Semester (${assessmentData.weights.directMethods.endSem}%)</th>
                        <th>Assignments (${assessmentData.weights.directMethods.assignments}%)</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            currentCourse.cos.forEach((co, index) => {
                html += `
                    <tr>
                        <td>${co}</td>
                        <td>${currentCourse.coDescriptions[index] || 'CO Description'}</td>
                        <td>
                            <input type="number" id="direct-internal-${co}" 
                                   min="0" max="100" value="0" 
                                   data-co="${co}" data-method="internal">
                        </td>
                        <td>
                            <input type="number" id="direct-endsem-${co}" 
                                   min="0" max="100" value="0"
                                   data-co="${co}" data-method="endSem">
                        </td>
                        <td>
                            <input type="number" id="direct-assignments-${co}" 
                                   min="0" max="100" value="0"
                                   data-co="${co}" data-method="assignments">
                        </td>
                        <td id="direct-weighted-${co}" class="weighted-score">0.0</td>
                        <td id="direct-attainment-${co}" class="attainment-score">0.0%</td>
                    </tr>
                `;
            });
            
            html += `
                <tr style="background-color: #f0f8ff; font-weight: bold;">
                    <td colspan="4">Average / Target</td>
                    <td id="direct-avg-weighted">0.0</td>
                    <td id="direct-avg-attainment">0.0% / ${assessmentData.targets.direct}%</td>
                </tr>
            </tbody>`;
            
            table.innerHTML = html;
            
            // Add event listeners to inputs
            document.querySelectorAll('#directInputTable input[type="number"]').forEach(input => {
                input.addEventListener('input', updateDirectScore);
            });
        }

        // Create indirect assessment input table
        function createIndirectInputTable() {
            if (!currentCourse) return;
            
            const table = document.getElementById('indirectInputTable');
            let html = `
                <thead>
                    <tr>
                        <th rowspan="2">CO Code</th>
                        <th rowspan="2">Description</th>
                        <th colspan="3">Indirect Assessment Scores (1-5 Likert Scale)</th>
                        <th rowspan="2">Weighted Score</th>
                        <th rowspan="2">Indirect Attainment</th>
                    </tr>
                    <tr>
                        <th>Exit Survey (${assessmentData.weights.indirectMethods.exitSurvey}%)</th>
                        <th>Alumni Feedback (${assessmentData.weights.indirectMethods.alumni}%)</th>
                        <th>Employer Feedback (${assessmentData.weights.indirectMethods.employer}%)</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            currentCourse.cos.forEach((co, index) => {
                html += `
                    <tr>
                        <td>${co}</td>
                        <td>${currentCourse.coDescriptions[index] || 'CO Description'}</td>
                        <td>
                            <input type="number" id="indirect-exitsurvey-${co}" 
                                   min="1" max="5" value="3" step="0.1"
                                   data-co="${co}" data-method="exitSurvey">
                        </td>
                        <td>
                            <input type="number" id="indirect-alumni-${co}" 
                                   min="1" max="5" value="3" step="0.1"
                                   data-co="${co}" data-method="alumni">
                        </td>
                        <td>
                            <input type="number" id="indirect-employer-${co}" 
                                   min="1" max="5" value="3" step="0.1"
                                   data-co="${co}" data-method="employer">
                        </td>
                        <td id="indirect-weighted-${co}" class="weighted-score">0.0</td>
                        <td id="indirect-attainment-${co}" class="attainment-score">0.0%</td>
                    </tr>
                `;
            });
            
            html += `
                <tr style="background-color: #f0f8ff; font-weight: bold;">
                    <td colspan="4">Average / Target</td>
                    <td id="indirect-avg-weighted">0.0</td>
                    <td id="indirect-avg-attainment">0.0% / ${assessmentData.targets.indirect}%</td>
                </tr>
            </tbody>`;
            
            table.innerHTML = html;
            
            // Add event listeners to inputs
            document.querySelectorAll('#indirectInputTable input[type="number"]').forEach(input => {
                input.addEventListener('input', updateIndirectScore);
            });
        }

        // Create results table
        function createResultsTable() {
            if (!currentCourse) return;
            
            const table = document.getElementById('coResultsTable');
            let html = `
                <thead>
                    <tr>
                        <th>CO Code</th>
                        <th>Description</th>
                        <th>Direct Attainment</th>
                        <th>Indirect Attainment</th>
                        <th>Overall Attainment</th>
                        <th>Attainment Level</th>
                        <th>Target Met</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            currentCourse.cos.forEach((co, index) => {
                html += `
                    <tr>
                        <td>${co}</td>
                        <td>${currentCourse.coDescriptions[index] || 'CO Description'}</td>
                        <td id="result-direct-${co}">0.0%</td>
                        <td id="result-indirect-${co}">0.0%</td>
                        <td id="result-overall-${co}">0.0%</td>
                        <td id="result-level-${co}">-</td>
                        <td id="result-target-${co}">-</td>
                    </tr>
                `;
            });
            
            html += `</tbody>`;
            table.innerHTML = html;
        }

        // Create CO-PO matrix table
        function createMatrixTable() {
            if (!currentCourse) return;
            
            const table = document.getElementById('matrixTable');
            let html = `
                <thead>
                    <tr>
                        <th rowspan="2">CO Code</th>
                        <th colspan="11">Program Outcomes (POs)</th>
                        <th colspan="3">Program Specific Outcomes (PSOs)</th>
                    </tr>
                    <tr>
            `;
            
            // Add PO headers
            for (let i = 1; i <= 11; i++) {
                html += `<th>PO ${i}</th>`;
            }
            
            // Add PSO headers
            for (let i = 1; i <= 3; i++) {
                html += `<th>PSO ${i}</th>`;
            }
            
            html += `</tr></thead><tbody>`;
            
            // Get matrix data for this course or use default
            const matrixData = sampleMatrix[currentCourse.code] || 
                Array(currentCourse.cos.length).fill().map(() => Array(14).fill(0));
            
            currentCourse.cos.forEach((co, coIndex) => {
                html += `<tr><td>${co}</td>`;
                
                for (let poIndex = 0; poIndex < 14; poIndex++) {
                    const value = matrixData[coIndex][poIndex];
                    let cellClass = 'correlation-none';
                    
                    if (value === 3) cellClass = 'correlation-high';
                    else if (value === 2) cellClass = 'correlation-medium';
                    else if (value === 1) cellClass = 'correlation-low';
                    
                    html += `
                        <td class="${cellClass}">
                            <select class="correlation-select" 
                                    data-co-index="${coIndex}" 
                                    data-po-index="${poIndex}"
                                    style="border: none; background: transparent; width: 100%; text-align: center;">
                                <option value="0" ${value === 0 ? 'selected' : ''}>-</option>
                                <option value="1" ${value === 1 ? 'selected' : ''}>1</option>
                                <option value="2" ${value === 2 ? 'selected' : ''}>2</option>
                                <option value="3" ${value === 3 ? 'selected' : ''}>3</option>
                            </select>
                        </td>
                    `;
                }
                
                html += `</tr>`;
            });
            
            html += `</tbody>`;
            table.innerHTML = html;
        }

        // Update weight display and validation
        function updateWeights() {
            const directWeight = parseInt(document.getElementById('directWeight').value) || 0;
            const indirectWeight = parseInt(document.getElementById('indirectWeight').value) || 0;
            const totalWeight = directWeight + indirectWeight;
            
            // Update displays
            document.getElementById('directWeightDisplay').textContent = directWeight;
            document.getElementById('indirectWeightDisplay').textContent = indirectWeight;
            document.getElementById('totalWeight').textContent = totalWeight;
            
            // Validate weights
            const weightStatus = document.getElementById('weightStatus');
            if (totalWeight === 100) {
                weightStatus.textContent = '✓ Weights are properly balanced';
                weightStatus.style.color = '#2ecc71';
                
                // Update assessment data
                assessmentData.weights.direct = directWeight;
                assessmentData.weights.indirect = indirectWeight;
            } else {
                weightStatus.textContent = `⚠ Weights total ${totalWeight}% (should be 100%)`;
                weightStatus.style.color = '#e74c3c';
            }
        }

        // Update direct method weights
        function updateDirectWeights() {
            const internal = parseInt(document.getElementById('weightInternal').value) || 0;
            const endSem = parseInt(document.getElementById('weightEndSem').value) || 0;
            const assignments = parseInt(document.getElementById('weightAssignments').value) || 0;
            const total = internal + endSem + assignments;
            
            if (total === 100) {
                assessmentData.weights.directMethods.internal = internal;
                assessmentData.weights.directMethods.endSem = endSem;
                assessmentData.weights.directMethods.assignments = assignments;
                
                // Update table headers
                updateDirectTableHeaders();
            }
        }

        // Update indirect method weights
        function updateIndirectWeights() {
            const exitSurvey = parseInt(document.getElementById('weightExitSurvey').value) || 0;
            const alumni = parseInt(document.getElementById('weightAlumni').value) || 0;
            const employer = parseInt(document.getElementById('weightEmployer').value) || 0;
            const total = exitSurvey + alumni + employer;
            
            if (total === 100) {
                assessmentData.weights.indirectMethods.exitSurvey = exitSurvey;
                assessmentData.weights.indirectMethods.alumni = alumni;
                assessmentData.weights.indirectMethods.employer = employer;
                
                // Update table headers
                updateIndirectTableHeaders();
            }
        }

        // Update direct table headers with new weights
        function updateDirectTableHeaders() {
            const headers = document.querySelectorAll('#directInputTable th');
            if (headers.length >= 4) {
                headers[2].textContent = `Internal Tests (${assessmentData.weights.directMethods.internal}%)`;
                headers[3].textContent = `End Semester (${assessmentData.weights.directMethods.endSem}%)`;
                headers[4].textContent = `Assignments (${assessmentData.weights.directMethods.assignments}%)`;
            }
        }

        // Update indirect table headers with new weights
        function updateIndirectTableHeaders() {
            const headers = document.querySelectorAll('#indirectInputTable th');
            if (headers.length >= 4) {
                headers[2].textContent = `Exit Survey (${assessmentData.weights.indirectMethods.exitSurvey}%)`;
                headers[3].textContent = `Alumni Feedback (${assessmentData.weights.indirectMethods.alumni}%)`;
                headers[4].textContent = `Employer Feedback (${assessmentData.weights.indirectMethods.employer}%)`;
            }
        }

        // Update weight display
        function updateWeightDisplay() {
            document.getElementById('directWeight').value = assessmentData.weights.direct;
            document.getElementById('indirectWeight').value = assessmentData.weights.indirect;
            document.getElementById('weightInternal').value = assessmentData.weights.directMethods.internal;
            document.getElementById('weightEndSem').value = assessmentData.weights.directMethods.endSem;
            document.getElementById('weightAssignments').value = assessmentData.weights.directMethods.assignments;
            document.getElementById('weightExitSurvey').value = assessmentData.weights.indirectMethods.exitSurvey;
            document.getElementById('weightAlumni').value = assessmentData.weights.indirectMethods.alumni;
            document.getElementById('weightEmployer').value = assessmentData.weights.indirectMethods.employer;
            
            updateWeights();
        }

        // Save weights configuration
        function saveWeights() {
            // Validate total weights
            const totalWeight = assessmentData.weights.direct + assessmentData.weights.indirect;
            if (totalWeight !== 100) {
                alert(`Total weight must be 100% (currently ${totalWeight}%). Please adjust weights.`);
                return;
            }
            
            // Validate direct method weights
            const directTotal = assessmentData.weights.directMethods.internal + 
                               assessmentData.weights.directMethods.endSem + 
                               assessmentData.weights.directMethods.assignments;
            if (directTotal !== 100) {
                alert(`Direct method weights must total 100% (currently ${directTotal}%).`);
                return;
            }
            
            // Validate indirect method weights
            const indirectTotal = assessmentData.weights.indirectMethods.exitSurvey + 
                                 assessmentData.weights.indirectMethods.alumni + 
                                 assessmentData.weights.indirectMethods.employer;
            if (indirectTotal !== 100) {
                alert(`Indirect method weights must total 100% (currently ${indirectTotal}%).`);
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('assessmentWeights', JSON.stringify(assessmentData.weights));
            localStorage.setItem('assessmentTargets', JSON.stringify(assessmentData.targets));
            
            alert('Assessment configuration saved successfully!');
            
            // Switch to direct assessment tab
            document.querySelector('[data-tab="direct"]').click();
        }

        // Update direct score when input changes
        function updateDirectScore(event) {
            const input = event.target;
            const co = input.getAttribute('data-co');
            const method = input.getAttribute('data-method');
            const value = parseFloat(input.value) || 0;
            
            // Update assessment data
            assessmentData.direct[method][co] = value;
            
            // Calculate weighted score for this CO
            calculateDirectWeightedScore(co);
        }

        // Calculate direct weighted score for a specific CO
        function calculateDirectWeightedScore(co) {
            const internal = assessmentData.direct.internal[co] || 0;
            const endSem = assessmentData.direct.endSem[co] || 0;
            const assignments = assessmentData.direct.assignments[co] || 0;
            
            // Calculate weighted score
            const weightedScore = 
                (internal * assessmentData.weights.directMethods.internal / 100) +
                (endSem * assessmentData.weights.directMethods.endSem / 100) +
                (assignments * assessmentData.weights.directMethods.assignments / 100);
            
            // Update display
            document.getElementById(`direct-weighted-${co}`).textContent = weightedScore.toFixed(1);
            document.getElementById(`direct-attainment-${co}`).textContent = weightedScore.toFixed(1) + '%';
            
            // Update assessment data
            assessmentData.direct[co] = weightedScore;
            
            // Calculate average
            calculateDirectAverage();
        }

        // Calculate direct average attainment
        function calculateDirectAverage() {
            if (!currentCourse) return;
            
            let totalWeighted = 0;
            let count = 0;
            
            currentCourse.cos.forEach(co => {
                const weightedElement = document.getElementById(`direct-weighted-${co}`);
                if (weightedElement) {
                    const value = parseFloat(weightedElement.textContent) || 0;
                    totalWeighted += value;
                    count++;
                }
            });
            
            const average = count > 0 ? totalWeighted / count : 0;
            
            // Update display
            document.getElementById('direct-avg-weighted').textContent = average.toFixed(1);
            document.getElementById('direct-avg-attainment').textContent = 
                `${average.toFixed(1)}% / ${assessmentData.targets.direct}%`;
        }

        // Update indirect score when input changes
        function updateIndirectScore(event) {
            const input = event.target;
            const co = input.getAttribute('data-co');
            const method = input.getAttribute('data-method');
            const value = parseFloat(input.value) || 0;
            
            // Update assessment data
            assessmentData.indirect[method][co] = value;
            
            // Calculate weighted score for this CO
            calculateIndirectWeightedScore(co);
        }

        // Calculate indirect weighted score for a specific CO
        function calculateIndirectWeightedScore(co) {
            const exitSurvey = assessmentData.indirect.exitSurvey[co] || 0;
            const alumni = assessmentData.indirect.alumni[co] || 0;
            const employer = assessmentData.indirect.employer[co] || 0;
            
            // Convert Likert scale (1-5) to percentage (0-100%)
            const exitSurveyPercent = ((exitSurvey - 1) / 4) * 100;
            const alumniPercent = ((alumni - 1) / 4) * 100;
            const employerPercent = ((employer - 1) / 4) * 100;
            
            // Calculate weighted score
            const weightedScore = 
                (exitSurveyPercent * assessmentData.weights.indirectMethods.exitSurvey / 100) +
                (alumniPercent * assessmentData.weights.indirectMethods.alumni / 100) +
                (employerPercent * assessmentData.weights.indirectMethods.employer / 100);
            
            // Update display
            document.getElementById(`indirect-weighted-${co}`).textContent = weightedScore.toFixed(1);
            document.getElementById(`indirect-attainment-${co}`).textContent = weightedScore.toFixed(1) + '%';
            
            // Update assessment data
            assessmentData.indirect[co] = weightedScore;
            
            // Calculate average
            calculateIndirectAverage();
        }

        // Calculate indirect average attainment
        function calculateIndirectAverage() {
            if (!currentCourse) return;
            
            let totalWeighted = 0;
            let count = 0;
            
            currentCourse.cos.forEach(co => {
                const weightedElement = document.getElementById(`indirect-weighted-${co}`);
                if (weightedElement) {
                    const value = parseFloat(weightedElement.textContent) || 0;
                    totalWeighted += value;
                    count++;
                }
            });
            
            const average = count > 0 ? totalWeighted / count : 0;
            
            // Update display
            document.getElementById('indirect-avg-weighted').textContent = average.toFixed(1);
            document.getElementById('indirect-avg-attainment').textContent = 
                `${average.toFixed(1)}% / ${assessmentData.targets.indirect}%`;
        }

        // Calculate direct attainment
        function calculateDirectAttainment() {
            if (!currentCourse) {
                alert('Please configure a course first.');
                return;
            }
            
            // Calculate weighted scores for all COs
            currentCourse.cos.forEach(co => {
                calculateDirectWeightedScore(co);
            });
            
            alert('Direct attainment calculated successfully!');
            
            // Switch to indirect assessment tab
            document.querySelector('[data-tab="indirect"]').click();
        }

        // Calculate indirect attainment
        function calculateIndirectAttainment() {
            if (!currentCourse) {
                alert('Please configure a course first.');
                return;
            }
            
            // Calculate weighted scores for all COs
            currentCourse.cos.forEach(co => {
                calculateIndirectWeightedScore(co);
            });
            
            alert('Indirect attainment calculated successfully!');
            
            // Calculate overall attainment
            calculateOverallAttainment();
            
            // Switch to results tab
            document.querySelector('[data-tab="results"]').click();
        }

        // Calculate overall CO attainment
        function calculateOverallAttainment() {
            if (!currentCourse) return;
            
            let totalDirect = 0;
            let totalIndirect = 0;
            let totalOverall = 0;
            let cosAboveTarget = 0;
            
            currentCourse.cos.forEach(co => {
                // Get direct and indirect attainment
                const directElement = document.getElementById(`direct-attainment-${co}`);
                const indirectElement = document.getElementById(`indirect-attainment-${co}`);
                
                const directAttainment = parseFloat(directElement ? directElement.textContent : '0') || 0;
                const indirectAttainment = parseFloat(indirectElement ? indirectElement.textContent : '0') || 0;
                
                // Calculate overall attainment
                const overallAttainment = 
                    (directAttainment * assessmentData.weights.direct / 100) +
                    (indirectAttainment * assessmentData.weights.indirect / 100);
                
                // Update results table
                document.getElementById(`result-direct-${co}`).textContent = directAttainment.toFixed(1) + '%';
                document.getElementById(`result-indirect-${co}`).textContent = indirectAttainment.toFixed(1) + '%';
                document.getElementById(`result-overall-${co}`).textContent = overallAttainment.toFixed(1) + '%';
                
                // Determine attainment level
                const attainmentLevel = getAttainmentLevel(overallAttainment);
                document.getElementById(`result-level-${co}`).innerHTML = 
                    `<span class="attainment-level level-${attainmentLevel}">${attainmentLevel.toUpperCase()}</span>`;
                
                // Check if target is met
                const targetMet = overallAttainment >= assessmentData.targets.overall;
                document.getElementById(`result-target-${co}`).innerHTML = 
                    targetMet ? '✓ MET' : '✗ NOT MET';
                
                // Update totals
                totalDirect += directAttainment;
                totalIndirect += indirectAttainment;
                totalOverall += overallAttainment;
                
                if (overallAttainment >= assessmentData.targets.overall) {
                    cosAboveTarget++;
                }
            });
            
            // Calculate averages
            const avgDirect = totalDirect / currentCourse.cos.length;
            const avgIndirect = totalIndirect / currentCourse.cos.length;
            const avgOverall = totalOverall / currentCourse.cos.length;
            
            // Update summary statistics
            document.getElementById('avgAttainment').textContent = avgOverall.toFixed(1) + '%';
            document.getElementById('cosAboveTarget').textContent = `${cosAboveTarget} / ${currentCourse.cos.length}`;
            document.getElementById('overallAttainment').textContent = avgOverall.toFixed(1) + '%';
            
            const overallLevel = getAttainmentLevel(avgOverall);
            document.getElementById('attainmentLevel').innerHTML = 
                `<span class="attainment-level level-${overallLevel}">${overallLevel.toUpperCase()}</span>`;
            
            // Generate analysis
            generateAttainmentAnalysis(avgOverall, cosAboveTarget, currentCourse.cos.length);
            
            // Create visualization
            createCOChart();
            
            // Save results
            saveResults();
        }

        // Get attainment level based on percentage
        function getAttainmentLevel(percentage) {
            if (percentage >= 80) return 'high';
            if (percentage >= 60) return 'medium';
            return 'low';
        }

        // Generate attainment analysis
        function generateAttainmentAnalysis(avgAttainment, cosAboveTarget, totalCOs) {
            const analysisDiv = document.getElementById('attainmentAnalysis');
            
            let analysis = `
                <h4>Attainment Analysis</h4>
                <p><strong>Overall CO Attainment:</strong> ${avgAttainment.toFixed(1)}%</p>
                <p><strong>COs Meeting Target:</strong> ${cosAboveTarget} out of ${totalCOs} (${((cosAboveTarget/totalCOs)*100).toFixed(1)}%)</p>
                <p><strong>Assessment Method Contribution:</strong></p>
                <ul>
                    <li>Direct Assessment: ${assessmentData.weights.direct}% weight</li>
                    <li>Indirect Assessment: ${assessmentData.weights.indirect}% weight</li>
                </ul>
            `;
            
            if (avgAttainment >= assessmentData.targets.overall) {
                analysis += `
                    <div style="background-color: #d4edda; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <strong>✓ COURSE OUTCOMES ACHIEVED:</strong> The course has successfully achieved its learning outcomes.
                        Overall attainment (${avgAttainment.toFixed(1)}%) exceeds the target of ${assessmentData.targets.overall}%.
                    </div>
                `;
            } else {
                analysis += `
                    <div style="background-color: #f8d7da; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <strong>⚠ IMPROVEMENT NEEDED:</strong> The course has not fully achieved its learning outcomes.
                        Overall attainment (${avgAttainment.toFixed(1)}%) is below the target of ${assessmentData.targets.overall}%.
                        Consider reviewing teaching methods, assessment strategies, or course content.
                    </div>
                `;
            }
            
            analysisDiv.innerHTML = analysis;
        }

        // Create CO attainment chart
        function createCOChart() {
            const ctx = document.getElementById('coChart').getContext('2d');
            
            // Destroy previous chart if exists
            if (coChart) {
                coChart.destroy();
            }
            
            // Prepare data
            const coLabels = currentCourse.cos;
            const attainmentData = [];
            const targetData = [];
            
            currentCourse.cos.forEach(co => {
                const overallElement = document.getElementById(`result-overall-${co}`);
                const attainment = parseFloat(overallElement ? overallElement.textContent : '0') || 0;
                attainmentData.push(attainment);
                targetData.push(assessmentData.targets.overall);
            });
            
            // Create chart
            coChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: coLabels,
                    datasets: [
                        {
                            label: 'CO Attainment',
                            data: attainmentData,
                            backgroundColor: attainmentData.map(val => {
                                if (val >= assessmentData.targets.overall) return 'rgba(46, 204, 113, 0.8)';
                                return 'rgba(231, 76, 60, 0.8)';
                            }),
                            borderColor: attainmentData.map(val => {
                                if (val >= assessmentData.targets.overall) return 'rgba(39, 174, 96, 1)';
                                return 'rgba(192, 57, 43, 1)';
                            }),
                            borderWidth: 1
                        },
                        {
                            label: 'Target',
                            data: targetData,
                            type: 'line',
                            fill: false,
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Attainment (%)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Course Outcomes (COs)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw.toFixed(1)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Save matrix
        function saveMatrix() {
            if (!currentCourse) return;
            
            // Collect matrix data
            const matrixData = [];
            const selects = document.querySelectorAll('.correlation-select');
            
            // Group by CO index
            const coIndices = new Set();
            selects.forEach(select => {
                coIndices.add(select.getAttribute('data-co-index'));
            });
            
            coIndices.forEach(coIndex => {
                const row = [];
                selects.forEach(select => {
                    if (select.getAttribute('data-co-index') === coIndex) {
                        row.push(parseInt(select.value));
                    }
                });
                matrixData.push(row);
            });
            
            // Save to localStorage
            localStorage.setItem(`matrix-${currentCourse.code}`, JSON.stringify(matrixData));
            
            alert('CO-PO matrix saved successfully!');
        }

        // Auto-calculate PO attainment from CO attainment and matrix
        function autoCalculatePOAttainment() {
            if (!currentCourse) {
                alert('Please configure a course first.');
                return;
            }
            
            // Check if CO attainment is calculated
            let hasCOAttainment = false;
            currentCourse.cos.forEach(co => {
                const overallElement = document.getElementById(`result-overall-${co}`);
                if (overallElement && overallElement.textContent !== '0.0%') {
                    hasCOAttainment = true;
                }
            });
            
            if (!hasCOAttainment) {
                alert('Please calculate CO attainment first before calculating PO attainment.');
                return;
            }
            
            // Get CO attainment values
            const coAttainment = {};
            currentCourse.cos.forEach(co => {
                const overallElement = document.getElementById(`result-overall-${co}`);
                const attainment = parseFloat(overallElement.textContent) || 0;
                coAttainment[co] = attainment;
            });
            
            // Get matrix data
            const matrixData = JSON.parse(localStorage.getItem(`matrix-${currentCourse.code}`)) || 
                             sampleMatrix[currentCourse.code];
            
            if (!matrixData) {
                alert('No matrix data found for this course. Please save the matrix first.');
                return;
            }
            
            // Calculate PO attainment
            const poAttainment = new Array(14).fill(0);
            const poWeights = new Array(14).fill(0);
            
            currentCourse.cos.forEach((co, coIndex) => {
                const coValue = coAttainment[co];
                const matrixRow = matrixData[coIndex];
                
                for (let poIndex = 0; poIndex < 14; poIndex++) {
                    const correlation = matrixRow[poIndex];
                    if (correlation > 0) {
                        poAttainment[poIndex] += correlation * coValue;
                        poWeights[poIndex] += correlation;
                    }
                }
            });
            
            // Calculate weighted averages
            const poResults = poAttainment.map((sum, index) => {
                return poWeights[index] > 0 ? (sum / poWeights[index]) : 0;
            });
            
            // Display PO attainment
            displayPOAttainment(poResults);
        }

        // Display PO attainment results
        function displayPOAttainment(poResults) {
            let resultHTML = `
                <h4>PO Attainment Results (Auto-calculated from CO Attainment)</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <tr>
                        <th style="padding: 8px; background-color: #3498db; color: white;">PO/PSO</th>
                        <th style="padding: 8px; background-color: #3498db; color: white;">Attainment</th>
                        <th style="padding: 8px; background-color: #3498db; color: white;">Level</th>
                    </tr>
            `;
            
            // POs 1-11
            for (let i = 0; i < 11; i++) {
                const attainment = poResults[i];
                const level = getAttainmentLevel(attainment);
                const levelClass = `level-${level}`;
                
                resultHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">PO ${i+1}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${attainment.toFixed(1)}%</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">
                            <span class="attainment-level ${levelClass}">${level.toUpperCase()}</span>
                        </td>
                    </tr>
                `;
            }
            
            // PSOs
            for (let i = 11; i < 14; i++) {
                const attainment = poResults[i];
                const level = getAttainmentLevel(attainment);
                const levelClass = `level-${level}`;
                
                resultHTML += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">PSO ${i-10}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${attainment.toFixed(1)}%</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">
                            <span class="attainment-level ${levelClass}">${level.toUpperCase()}</span>
                        </td>
                    </tr>
                `;
            }
            
            resultHTML += `</table>`;
            
            // Add to analysis section
            const analysisDiv = document.getElementById('attainmentAnalysis');
            analysisDiv.innerHTML = resultHTML + analysisDiv.innerHTML;
            
            alert('PO attainment calculated successfully from CO attainment and correlation matrix!');
        }

        // Save results to localStorage
        function saveResults() {
            if (!currentCourse) return;
            
            const results = {
                course: currentCourse.code,
                semester: document.getElementById('semester').value,
                timestamp: new Date().toISOString(),
                assessmentData: assessmentData,
                coAttainment: {}
            };
            
            // Collect CO attainment data
            currentCourse.cos.forEach(co => {
                const overallElement = document.getElementById(`result-overall-${co}`);
                results.coAttainment[co] = parseFloat(overallElement.textContent) || 0;
            });
            
            // Save to localStorage
            localStorage.setItem(`results-${currentCourse.code}`, JSON.stringify(results));
            localStorage.setItem('lastCourse', currentCourse.code);
        }

        // Load saved data
        function loadSavedData() {
            // Load weights and targets
            const savedWeights = localStorage.getItem('assessmentWeights');
            const savedTargets = localStorage.getItem('assessmentTargets');
            
            if (savedWeights) {
                assessmentData.weights = JSON.parse(savedWeights);
            }
            
            if (savedTargets) {
                assessmentData.targets = JSON.parse(savedTargets);
            }
            
            // Update UI
            updateWeightDisplay();
            document.getElementById('directTarget').value = assessmentData.targets.direct;
            document.getElementById('directTargetValue').textContent = assessmentData.targets.direct + '%';
            document.getElementById('indirectTarget').value = assessmentData.targets.indirect;
            document.getElementById('indirectTargetValue').textContent = assessmentData.targets.indirect + '%';
        }

        // Load course data
        function loadCourseData() {
            if (!currentCourse) return;
            
            // Load saved results for this course
            const savedResults = localStorage.getItem(`results-${currentCourse.code}`);
            if (savedResults) {
                const results = JSON.parse(savedResults);
                
                // Load direct assessment data
                if (results.assessmentData && results.assessmentData.direct) {
                    Object.keys(results.assessmentData.direct).forEach(method => {
                        if (typeof results.assessmentData.direct[method] === 'object') {
                            Object.keys(results.assessmentData.direct[method]).forEach(co => {
                                const input = document.getElementById(`direct-${method}-${co}`);
                                if (input) {
                                    input.value = results.assessmentData.direct[method][co];
                                    assessmentData.direct[method][co] = results.assessmentData.direct[method][co];
                                }
                            });
                        }
                    });
                    
                    // Recalculate direct attainment
                    currentCourse.cos.forEach(co => {
                        calculateDirectWeightedScore(co);
                    });
                }
                
                // Load indirect assessment data
                if (results.assessmentData && results.assessmentData.indirect) {
                    Object.keys(results.assessmentData.indirect).forEach(method => {
                        if (typeof results.assessmentData.indirect[method] === 'object') {
                            Object.keys(results.assessmentData.indirect[method]).forEach(co => {
                                const input = document.getElementById(`indirect-${method}-${co}`);
                                if (input) {
                                    input.value = results.assessmentData.indirect[method][co];
                                    assessmentData.indirect[method][co] = results.assessmentData.indirect[method][co];
                                }
                            });
                        }
                    });
                    
                    // Recalculate indirect attainment
                    currentCourse.cos.forEach(co => {
                        calculateIndirectWeightedScore(co);
                    });
                }
                
                // Calculate overall attainment if data exists
                if (Object.keys(results.coAttainment || {}).length > 0) {
                    calculateOverallAttainment();
                }
            }
        }

        // Export report
        function exportReport() {
            if (!currentCourse) {
                alert('Please configure a course and calculate attainment first.');
                return;
            }
            
            // Collect data for export
            const report = {
                course: {
                    code: currentCourse.code,
                    name: currentCourse.name,
                    semester: document.getElementById('semester').value,
                    cos: currentCourse.cos
                },
                assessment: {
                    weights: assessmentData.weights,
                    targets: assessmentData.targets
                },
                results: {},
                timestamp: new Date().toISOString()
            };
            
            // Collect CO attainment results
            currentCourse.cos.forEach(co => {
                report.results[co] = {
                    direct: document.getElementById(`result-direct-${co}`).textContent,
                    indirect: document.getElementById(`result-indirect-${co}`).textContent,
                    overall: document.getElementById(`result-overall-${co}`).textContent,
                    level: document.getElementById(`result-level-${co}`).textContent,
                    targetMet: document.getElementById(`result-target-${co}`).textContent
                };
            });
            
            // Create downloadable JSON file
            const dataStr = JSON.stringify(report, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `co-attainment-report-${currentCourse.code}-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Print report
        function printReport() {
            window.print();
        }

        // Reset all data
        function resetAllData() {
            if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
                // Clear localStorage for this course
                if (currentCourse) {
                    localStorage.removeItem(`results-${currentCourse.code}`);
                    localStorage.removeItem(`matrix-${currentCourse.code}`);
                }
                
                // Reset assessment data
                assessmentData = {
                    direct: {},
                    indirect: {},
                    weights: {
                        direct: 70,
                        indirect: 30,
                        directMethods: {
                            internal: 40,
                            endSem: 40,
                            assignments: 20
                        },
                        indirectMethods: {
                            exitSurvey: 50,
                            alumni: 30,
                            employer: 20
                        }
                    },
                    targets: {
                        direct: 70,
                        indirect: 75,
                        overall: 70
                    }
                };
                
                // Reset UI
                updateWeightDisplay();
                document.getElementById('courseInfo').style.display = 'none';
                
                // Reinitialize tables if course is configured
                if (currentCourse) {
                    initializeAssessmentData();
                    createDirectInputTable();
                    createIndirectInputTable();
                    createResultsTable();
                }
                
                alert('All data has been reset.');
            }
        }
    </script>
</body>
</html>
