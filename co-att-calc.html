<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CO Attainment Calculator</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .panel h3 {
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .matrix-container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: 600;
            padding: 12px 15px;
            text-align: center;
            white-space: nowrap;
        }
        
        td {
            padding: 12px 15px;
            border: 1px solid #e1e1e1;
            text-align: center;
        }
        
        .matrix-table th:first-child,
        .matrix-table td:first-child {
            background-color: #f8f9fa;
            font-weight: 600;
            position: sticky;
            left: 0;
            z-index: 1;
        }
        
        .input-cell {
            width: 60px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 1rem;
        }
        
        .input-cell:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-secondary {
            background-color: #7f8c8d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #636e72;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .results {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-top: 30px;
        }
        
        .co-attainment-display {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .co-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .co-code {
            font-weight: 700;
            font-size: 1.2rem;
            color: #2c3e50;
        }
        
        .co-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .co-level {
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .level-excellent { background-color: #2ecc71; color: white; }
        .level-good { background-color: #3498db; color: white; }
        .level-average { background-color: #f39c12; color: white; }
        .level-poor { background-color: #e74c3c; color: white; }
        
        .instructions {
            background-color: #e8f4fc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .matrix-table {
            min-width: 800px;
        }
        
        .weight-input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 992px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }
            
            .co-attainment-display {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        .highlight {
            background-color: #fff8e1;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #2c3e50;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-calculator"></i> CO Attainment Calculator</h1>
            <p class="subtitle">Automatically calculate Course Outcome attainment from articulation matrix</p>
        </header>
        
        <div class="instructions">
            <h3>How to use this tool:</h3>
            <ol>
                <li>Configure the number of COs, POs, and PSOs in the Settings panel</li>
                <li>Define the mapping between COs and POs/PSOs in the articulation matrix (1=Low, 2=Medium, 3=High)</li>
                <li>Enter assessment weights and student performance data</li>
                <li>Click "Calculate CO Attainment" to automatically compute CO attainment values</li>
            </ol>
        </div>
        
        <div class="dashboard">
            <div class="panel">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                
                <div class="form-group">
                    <label for="numCos">Number of Course Outcomes (COs):</label>
                    <input type="number" id="numCos" min="1" max="20" value="5">
                </div>
                
                <div class="form-group">
                    <label for="numPos">Number of Program Outcomes (POs):</label>
                    <input type="number" id="numPos" min="1" max="15" value="6">
                </div>
                
                <div class="form-group">
                    <label for="numPsos">Number of Program Specific Outcomes (PSOs):</label>
                    <input type="number" id="numPsos" min="0" max="10" value="2">
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="updateConfig">
                        <i class="fas fa-sync-alt"></i> Update Configuration
                    </button>
                    <button class="btn btn-secondary" id="loadSample">
                        <i class="fas fa-download"></i> Load Sample Data
                    </button>
                </div>
            </div>
            
            <div class="panel">
                <h2><i class="fas fa-balance-scale"></i> Assessment Weights</h2>
                <p>Define the weightage of each assessment component (total must equal 100%):</p>
                
                <div id="weightsContainer">
                    <!-- Weights will be dynamically generated here -->
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" id="resetWeights">
                        <i class="fas fa-undo"></i> Reset to Default
                    </button>
                </div>
            </div>
        </div>
        
        <div class="matrix-container">
            <h2><i class="fas fa-table"></i> Course Articulation Matrix</h2>
            <p>Define the correlation between COs and POs/PSOs (1=Low, 2=Medium, 3=High):</p>
            <div id="matrixTableContainer">
                <!-- Matrix table will be generated here -->
            </div>
        </div>
        
        <div class="matrix-container">
            <h2><i class="fas fa-chart-line"></i> Student Performance Data</h2>
            <p>Enter average student scores for each assessment component (as percentage):</p>
            <div id="performanceContainer">
                <!-- Performance table will be generated here -->
            </div>
        </div>
        
        <div class="btn-group" style="justify-content: center;">
            <button class="btn btn-success" id="calculateBtn" style="padding: 15px 30px; font-size: 1.1rem;">
                <i class="fas fa-calculator"></i> Calculate CO Attainment
            </button>
        </div>
        
        <div class="results" id="resultsSection" style="display: none;">
            <h2><i class="fas fa-chart-bar"></i> CO Attainment Results</h2>
            <p>Automatically calculated CO attainment values based on articulation matrix and student performance:</p>
            
            <div id="attainmentResults">
                <!-- CO attainment results will be displayed here -->
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="exportResults">
                    <i class="fas fa-file-export"></i> Export Results
                </button>
                <button class="btn btn-secondary" id="resetAll">
                    <i class="fas fa-trash-alt"></i> Reset All Data
                </button>
            </div>
        </div>
        
        <div class="footer">
            <p>CO Attainment Calculator Tool &copy; 2023 | For Educational Assessment Purposes</p>
        </div>
    </div>

    <script>
        // Configuration
        let config = {
            numCos: 5,
            numPos: 6,
            numPsos: 2,
            assessmentWeights: {
                internal1: 15,
                internal2: 15,
                assignment: 10,
                project: 10,
                endSem: 50
            },
            performanceData: {},
            articulationMatrix: {}
        };
        
        // DOM Elements
        const numCosInput = document.getElementById('numCos');
        const numPosInput = document.getElementById('numPos');
        const numPsosInput = document.getElementById('numPsos');
        const updateConfigBtn = document.getElementById('updateConfig');
        const loadSampleBtn = document.getElementById('loadSample');
        const weightsContainer = document.getElementById('weightsContainer');
        const resetWeightsBtn = document.getElementById('resetWeights');
        const matrixTableContainer = document.getElementById('matrixTableContainer');
        const performanceContainer = document.getElementById('performanceContainer');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultsSection = document.getElementById('resultsSection');
        const attainmentResults = document.getElementById('attainmentResults');
        const exportResultsBtn = document.getElementById('exportResults');
        const resetAllBtn = document.getElementById('resetAll');
        
        // Initialize the tool
        function initTool() {
            updateConfigFromInputs();
            generateWeightsInputs();
            generateMatrixTable();
            generatePerformanceTable();
            loadDefaultData();
        }
        
        // Update configuration from inputs
        function updateConfigFromInputs() {
            config.numCos = parseInt(numCosInput.value) || 5;
            config.numPos = parseInt(numPosInput.value) || 6;
            config.numPsos = parseInt(numPsosInput.value) || 2;
        }
        
        // Generate weights inputs
        function generateWeightsInputs() {
            const weights = config.assessmentWeights;
            let html = '<table>';
            
            let totalWeight = 0;
            for (const [key, value] of Object.entries(weights)) {
                const label = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1');
                totalWeight += value;
                
                html += `
                <tr>
                    <td>${label}:</td>
                    <td>
                        <input type="number" class="weight-input" 
                               data-weight="${key}" 
                               value="${value}" min="0" max="100">
                        %
                    </td>
                </tr>
                `;
            }
            
            html += `
            <tr>
                <td><strong>Total:</strong></td>
                <td><strong id="totalWeight">${totalWeight}%</strong></td>
            </tr>
            `;
            
            html += '</table>';
            weightsContainer.innerHTML = html;
            
            // Add event listeners to weight inputs
            const weightInputs = document.querySelectorAll('.weight-input');
            weightInputs.forEach(input => {
                input.addEventListener('input', updateTotalWeight);
            });
        }
        
        // Update total weight display
        function updateTotalWeight() {
            let total = 0;
            const weightInputs = document.querySelectorAll('.weight-input');
            
            weightInputs.forEach(input => {
                const value = parseInt(input.value) || 0;
                total += value;
                config.assessmentWeights[input.dataset.weight] = value;
            });
            
            document.getElementById('totalWeight').textContent = `${total}%`;
            
            // Highlight if total is not 100%
            if (total !== 100) {
                document.getElementById('totalWeight').style.color = '#e74c3c';
            } else {
                document.getElementById('totalWeight').style.color = '#27ae60';
            }
        }
        
        // Generate articulation matrix table
        function generateMatrixTable() {
            const { numCos, numPos, numPsos } = config;
            let html = '<table class="matrix-table"><thead><tr><th>CO / PO-PSO</th>';
            
            // Generate PO headers
            for (let i = 1; i <= numPos; i++) {
                html += `<th>PO${i}</th>`;
            }
            
            // Generate PSO headers
            for (let i = 1; i <= numPsos; i++) {
                html += `<th>PSO${i}</th>`;
            }
            
            html += '</tr></thead><tbody>';
            
            // Generate CO rows
            for (let co = 1; co <= numCos; co++) {
                html += `<tr><td>CO${co}</td>`;
                
                // Generate PO cells
                for (let po = 1; po <= numPos; po++) {
                    const cellId = `co${co}_po${po}`;
                    html += `
                    <td>
                        <select class="input-cell" id="${cellId}" data-co="${co}" data-po="${po}" data-type="po">
                            <option value="0">0</option>
                            <option value="1">1 (Low)</option>
                            <option value="2">2 (Medium)</option>
                            <option value="3">3 (High)</option>
                        </select>
                    </td>
                    `;
                }
                
                // Generate PSO cells
                for (let pso = 1; pso <= numPsos; pso++) {
                    const cellId = `co${co}_pso${pso}`;
                    html += `
                    <td>
                        <select class="input-cell" id="${cellId}" data-co="${co}" data-pso="${pso}" data-type="pso">
                            <option value="0">0</option>
                            <option value="1">1 (Low)</option>
                            <option value="2">2 (Medium)</option>
                            <option value="3">3 (High)</option>
                        </select>
                    </td>
                    `;
                }
                
                html += '</tr>';
            }
            
            html += '</tbody></table>';
            matrixTableContainer.innerHTML = html;
            
            // Load saved matrix data if available
            loadMatrixData();
        }
        
        // Generate performance table
        function generatePerformanceTable() {
            const weights = config.assessmentWeights;
            let html = '<table><thead><tr><th>CO / Assessment</th>';
            
            // Generate assessment headers
            for (const key in weights) {
                const label = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1');
                html += `<th>${label} (${weights[key]}%)</th>`;
            }
            
            html += '</tr></thead><tbody>';
            
            // Generate CO rows
            for (let co = 1; co <= config.numCos; co++) {
                html += `<tr><td>CO${co}</td>`;
                
                // Generate assessment cells
                for (const key in weights) {
                    const cellId = `co${co}_${key}`;
                    html += `
                    <td>
                        <input type="number" class="input-cell" id="${cellId}" 
                               min="0" max="100" value="0" placeholder="0-100">
                        %
                    </td>
                    `;
                }
                
                html += '</tr>';
            }
            
            html += '</tbody></table>';
            performanceContainer.innerHTML = html;
            
            // Load saved performance data if available
            loadPerformanceData();
        }
        
        // Load default/sample data
        function loadDefaultData() {
            // Sample articulation matrix data
            const sampleMatrix = {
                'co1_po1': '3', 'co1_po2': '2', 'co1_po3': '1', 'co1_po4': '0', 'co1_po5': '2', 'co1_po6': '0',
                'co1_pso1': '2', 'co1_pso2': '1',
                'co2_po1': '2', 'co2_po2': '3', 'co2_po3': '2', 'co2_po4': '1', 'co2_po5': '0', 'co2_po6': '0',
                'co2_pso1': '1', 'co2_pso2': '2',
                'co3_po1': '1', 'co3_po2': '2', 'co3_po3': '3', 'co3_po4': '2', 'co3_po5': '1', 'co3_po6': '0',
                'co3_pso1': '0', 'co3_pso2': '3',
                'co4_po1': '0', 'co4_po2': '1', 'co4_po3': '2', 'co4_po4': '3', 'co4_po5': '2', 'co4_po6': '1',
                'co4_pso1': '1', 'co4_pso2': '2',
                'co5_po1': '1', 'co5_po2': '0', 'co5_po3': '1', 'co5_po4': '2', 'co5_po5': '3', 'co5_po6': '2',
                'co5_pso1': '3', 'co5_pso2': '0'
            };
            
            // Sample performance data
            const samplePerformance = {
                'co1_internal1': '75', 'co1_internal2': '80', 'co1_assignment': '85', 'co1_project': '90', 'co1_endSem': '78',
                'co2_internal1': '82', 'co2_internal2': '79', 'co2_assignment': '88', 'co2_project': '85', 'co2_endSem': '81',
                'co3_internal1': '70', 'co3_internal2': '75', 'co3_assignment': '80', 'co3_project': '82', 'co3_endSem': '76',
                'co4_internal1': '85', 'co4_internal2': '88', 'co4_assignment': '90', 'co4_project': '92', 'co4_endSem': '87',
                'co5_internal1': '65', 'co5_internal2': '70', 'co5_assignment': '75', 'co5_project': '78', 'co5_endSem': '72'
            };
            
            // Populate articulation matrix with sample data
            for (const [id, value] of Object.entries(sampleMatrix)) {
                const element = document.getElementById(id);
                if (element) {
                    element.value = value;
                    config.articulationMatrix[id] = value;
                }
            }
            
            // Populate performance data with sample data
            for (const [id, value] of Object.entries(samplePerformance)) {
                const element = document.getElementById(id);
                if (element) {
                    element.value = value;
                    config.performanceData[id] = value;
                }
            }
        }
        
        // Load matrix data from config
        function loadMatrixData() {
            for (const [id, value] of Object.entries(config.articulationMatrix)) {
                const element = document.getElementById(id);
                if (element) {
                    element.value = value;
                }
            }
        }
        
        // Load performance data from config
        function loadPerformanceData() {
            for (const [id, value] of Object.entries(config.performanceData)) {
                const element = document.getElementById(id);
                if (element) {
                    element.value = value;
                }
            }
        }
        
        // Save matrix data to config
        function saveMatrixData() {
            const inputs = document.querySelectorAll('.matrix-table select');
            config.articulationMatrix = {};
            
            inputs.forEach(input => {
                config.articulationMatrix[input.id] = input.value;
            });
        }
        
        // Save performance data to config
        function savePerformanceData() {
            const inputs = document.querySelectorAll('#performanceContainer .input-cell');
            config.performanceData = {};
            
            inputs.forEach(input => {
                config.performanceData[input.id] = input.value;
            });
        }
        
        // Calculate CO attainment
        function calculateCOAttainment() {
            saveMatrixData();
            savePerformanceData();
            
            const { numCos, assessmentWeights, performanceData } = config;
            const coAttainment = {};
            
            // Calculate attainment for each CO
            for (let co = 1; co <= numCos; co++) {
                let totalWeightedScore = 0;
                let totalWeight = 0;
                
                // Calculate weighted average for each assessment
                for (const [assessment, weight] of Object.entries(assessmentWeights)) {
                    const key = `co${co}_${assessment}`;
                    const score = parseFloat(performanceData[key]) || 0;
                    
                    totalWeightedScore += score * (weight / 100);
                    totalWeight += weight;
                }
                
                // Average score for this CO (0-100 scale)
                const averageScore = totalWeightedScore;
                
                // Convert to 0-3 scale
                // We'll use a tiered approach:
                // 90+ = 3 (Exceeded)
                // 75-89 = 2 (Attained)
                // 60-74 = 1 (Partially Attained)
                // Below 60 = 0 (Not Attained)
                let attainmentValue;
                if (averageScore >= 90) attainmentValue = 3;
                else if (averageScore >= 75) attainmentValue = 2;
                else if (averageScore >= 60) attainmentValue = 1;
                else attainmentValue = 0;
                
                coAttainment[`CO${co}`] = {
                    value: attainmentValue,
                    score: averageScore.toFixed(2),
                    level: getAttainmentLevel(attainmentValue)
                };
            }
            
            return coAttainment;
        }
        
        // Get attainment level description
        function getAttainmentLevel(value) {
            switch(value) {
                case 3: return 'Exceeded';
                case 2: return 'Attained';
                case 1: return 'Partially Attained';
                default: return 'Not Attained';
            }
        }
        
        // Get attainment level class for styling
        function getAttainmentLevelClass(value) {
            switch(value) {
                case 3: return 'level-excellent';
                case 2: return 'level-good';
                case 1: return 'level-average';
                default: return 'level-poor';
            }
        }
        
        // Display CO attainment results
        function displayResults(coAttainment) {
            let html = '<div class="co-attainment-display">';
            
            for (const [coCode, data] of Object.entries(coAttainment)) {
                const levelClass = getAttainmentLevelClass(data.value);
                
                html += `
                <div class="co-card">
                    <div class="co-code">${coCode}</div>
                    <div class="co-value">${data.value}</div>
                    <div class="co-level ${levelClass}">${data.level}</div>
                    <div style="font-size: 0.9rem; color: #7f8c8d; margin-top: 8px;">
                        Avg. Score: ${data.score}%
                    </div>
                </div>
                `;
            }
            
            html += '</div>';
            
            // Also display a table with detailed mapping
            html += `
            <h3 style="margin-top: 30px;">Detailed CO-PO/PSO Mapping Attainment</h3>
            <div style="overflow-x: auto;">
                <table style="margin-top: 15px;">
                    <thead>
                        <tr>
                            <th>CO</th>
                            <th>PO/PSO Mapping</th>
                            <th>Weighted Attainment</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Calculate and display mapping attainment
            for (let co = 1; co <= config.numCos; co++) {
                let mappingHtml = '';
                let weightedSum = 0;
                let totalWeight = 0;
                
                // Calculate for POs
                for (let po = 1; po <= config.numPos; po++) {
                    const key = `co${co}_po${po}`;
                    const correlation = parseInt(config.articulationMatrix[key]) || 0;
                    
                    if (correlation > 0) {
                        mappingHtml += `PO${po} (${correlation}), `;
                        
                        // Calculate weighted attainment based on correlation
                        const coAttainmentValue = coAttainment[`CO${co}`].value;
                        weightedSum += coAttainmentValue * correlation;
                        totalWeight += correlation;
                    }
                }
                
                // Calculate for PSOs
                for (let pso = 1; pso <= config.numPsos; pso++) {
                    const key = `co${co}_pso${pso}`;
                    const correlation = parseInt(config.articulationMatrix[key]) || 0;
                    
                    if (correlation > 0) {
                        mappingHtml += `PSO${pso} (${correlation}), `;
                        
                        // Calculate weighted attainment based on correlation
                        const coAttainmentValue = coAttainment[`CO${co}`].value;
                        weightedSum += coAttainmentValue * correlation;
                        totalWeight += correlation;
                    }
                }
                
                // Remove trailing comma
                mappingHtml = mappingHtml.replace(/,\s*$/, '');
                
                // Calculate weighted attainment
                const weightedAttainment = totalWeight > 0 ? (weightedSum / totalWeight).toFixed(2) : 'N/A';
                
                html += `
                <tr>
                    <td>CO${co}</td>
                    <td>${mappingHtml || 'No mapping'}</td>
                    <td>${weightedAttainment}</td>
                </tr>
                `;
            }
            
            html += '</tbody></table></div>';
            attainmentResults.innerHTML = html;
            resultsSection.style.display = 'block';
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Export results as CSV
        function exportResults() {
            const coAttainment = calculateCOAttainment();
            let csvContent = "CO Code,Attainment Value,Attainment Level,Average Score(%)\n";
            
            for (const [coCode, data] of Object.entries(coAttainment)) {
                csvContent += `${coCode},${data.value},${data.level},${data.score}\n`;
            }
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'co_attainment_results.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Reset all data
        function resetAllData() {
            if (confirm('Are you sure you want to reset all data? This will clear all inputs and results.')) {
                config.performanceData = {};
                config.articulationMatrix = {};
                
                // Reset weights to default
                config.assessmentWeights = {
                    internal1: 15,
                    internal2: 15,
                    assignment: 10,
                    project: 10,
                    endSem: 50
                };
                
                // Reset configuration inputs
                numCosInput.value = 5;
                numPosInput.value = 6;
                numPsosInput.value = 2;
                
                // Reinitialize the tool
                initTool();
                
                // Hide results
                resultsSection.style.display = 'none';
            }
        }
        
        // Event Listeners
        updateConfigBtn.addEventListener('click', () => {
            updateConfigFromInputs();
            generateMatrixTable();
            generatePerformanceTable();
        });
        
        loadSampleBtn.addEventListener('click', () => {
            if (confirm('Load sample data? This will overwrite your current data.')) {
                loadDefaultData();
            }
        });
        
        resetWeightsBtn.addEventListener('click', () => {
            config.assessmentWeights = {
                internal1: 15,
                internal2: 15,
                assignment: 10,
                project: 10,
                endSem: 50
            };
            generateWeightsInputs();
        });
        
        calculateBtn.addEventListener('click', () => {
            // Check if weights total to 100%
            let totalWeight = 0;
            for (const weight of Object.values(config.assessmentWeights)) {
                totalWeight += weight;
            }
            
            if (totalWeight !== 100) {
                alert('Please ensure assessment weights total to 100% before calculating.');
                return;
            }
            
            const coAttainment = calculateCOAttainment();
            displayResults(coAttainment);
        });
        
        exportResultsBtn.addEventListener('click', exportResults);
        resetAllBtn.addEventListener('click', resetAllData);
        
        // Initialize the tool on load
        document.addEventListener('DOMContentLoaded', initTool);
    </script>
</body>
</html>
